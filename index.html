<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HM Trading Dashboard</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { color: #8892b0; font-size: 1.1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0,212,255,0.1);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .card-title { font-size: 1.3rem; font-weight: 600; }
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .badge-success { background: rgba(0,200,83,0.2); color: #00c853; }
        .badge-warning { background: rgba(255,193,7,0.2); color: #ffc107; }
        .badge-info { background: rgba(0,212,255,0.2); color: #00d4ff; }
        .badge-real { background: rgba(123,44,191,0.3); color: #c77dff; }
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .stat {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        .stat-label { color: #8892b0; font-size: 0.85rem; margin-bottom: 5px; }
        .stat-value { font-size: 1.4rem; font-weight: 600; }
        .stat-value.positive { color: #00c853; }
        .stat-value.negative { color: #ff5252; }
        .test-list { list-style: none; }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .test-item:last-child { border-bottom: none; }
        .test-name { display: flex; align-items: center; gap: 10px; }
        .test-icon { font-size: 1.2rem; }
        .test-status { font-size: 0.85rem; font-weight: 500; }
        .passed { color: #00c853; }
        .failed { color: #ff5252; }
        .skipped { color: #ffc107; }
        .bot-card { margin-bottom: 15px; }
        .bot-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        .bot-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        .bot-icon.pair { background: rgba(123,44,191,0.3); }
        .bot-icon.saz { background: rgba(0,212,255,0.3); }
        .bot-icon.sd { background: rgba(255,193,7,0.3); }
        .bot-icon.diverge { background: rgba(0,200,83,0.3); }
        .bot-desc { color: #8892b0; font-size: 0.9rem; margin-top: 5px; }
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }
        .timestamp {
            color: #8892b0;
            font-size: 0.85rem;
            text-align: center;
            margin-top: 30px;
        }
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00d4ff;
        }
        .full-width { grid-column: 1 / -1; }
        #chart-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
        }
        .chart-legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .trade-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .trade-table th, .trade-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .trade-table th {
            color: #8892b0;
            font-weight: 500;
            font-size: 0.85rem;
        }
        .trade-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .stat-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HM Trading Dashboard</h1>
            <p class="subtitle">C++ Cryptocurrency Trading System - Live Backtest Results</p>
        </header>

        <!-- TradingView Chart Section -->
        <div class="card full-width" style="margin-bottom: 20px;">
            <div class="card-header">
                <span class="card-title">BTC/USD Price & DivergeBot P&L</span>
                <span class="badge badge-real">REAL BACKTEST DATA</span>
            </div>
            <div id="chart-container"></div>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #26a69a;"></div>
                    <span>BTC/USD Candles</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #7b2cbf;"></div>
                    <span>Cumulative P&L ($)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #00d4ff; border-radius: 50%;"></div>
                    <span>Trade Entry/Exit</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Real Backtest Results -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">DivergeBot Backtest</span>
                    <span class="badge badge-success">LIVE DATA</span>
                </div>
                <div class="stat-grid">
                    <div class="stat">
                        <div class="stat-label">Total P&L</div>
                        <div class="stat-value positive" id="total-pnl">+$370.40</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Trades</div>
                        <div class="stat-value" id="total-trades">16</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value" id="win-rate">81.3%</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Avg Profit/Trade</div>
                        <div class="stat-value positive" id="avg-profit">+$23.15</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    <div class="stat-label">Backtest Period</div>
                    <div style="color: #fff; margin-top: 5px;">Nov 2-4, 2017 (BTC $7,000 era)</div>
                    <div class="stat-label" style="margin-top: 10px;">Strategy Parameters</div>
                    <div style="color: #8892b0; font-size: 0.85rem; margin-top: 5px;">EMA: 100 | Divergence: 0.3% | Size: 1 BTC</div>
                </div>
            </div>

            <!-- Trading Bots Overview -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Trading Bots</span>
                    <span class="badge badge-info">4 Strategies</span>
                </div>
                <div class="bot-card">
                    <div class="bot-header">
                        <div class="bot-icon pair">ðŸ“Š</div>
                        <div>
                            <strong>PairTradeBot</strong>
                            <div class="bot-desc">Statistical arbitrage using Bollinger Bands</div>
                        </div>
                    </div>
                </div>
                <div class="bot-card">
                    <div class="bot-header">
                        <div class="bot-icon saz">ðŸ“ˆ</div>
                        <div>
                            <strong>SazBot</strong>
                            <div class="bot-desc">Order book imbalance analysis</div>
                        </div>
                    </div>
                </div>
                <div class="bot-card">
                    <div class="bot-header">
                        <div class="bot-icon sd">ðŸ“‰</div>
                        <div>
                            <strong>SDBot</strong>
                            <div class="bot-desc">Standard deviation mean reversion</div>
                        </div>
                    </div>
                </div>
                <div class="bot-card">
                    <div class="bot-header">
                        <div class="bot-icon diverge">ðŸ”€</div>
                        <div>
                            <strong>DivergeBot</strong>
                            <div class="bot-desc">Price ratio divergence trading (TESTED)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unit Tests Results -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Unit Tests</span>
                    <span class="badge badge-success">15/15 Passed</span>
                </div>
                <ul class="test-list">
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> test_types</span>
                        <span class="test-status passed">4 tests passed</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> test_order_book</span>
                        <span class="test-status passed">3 tests passed</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> test_indicators</span>
                        <span class="test-status passed">4 tests passed</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> test_scheduler</span>
                        <span class="test-status passed">3 tests passed</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> test_bots</span>
                        <span class="test-status passed">9 tests passed</span>
                    </li>
                </ul>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%; background: linear-gradient(90deg, #00c853, #00d4ff);"></div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">System Status</span>
                    <span class="badge badge-success">Healthy</span>
                </div>
                <div class="stat-grid">
                    <div class="stat">
                        <div class="stat-label">Build Status</div>
                        <div class="stat-value passed">âœ… Passing</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">C++ Standard</div>
                        <div class="stat-value">C++20</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">CMake Version</div>
                        <div class="stat-value">3.20+</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Data Source</div>
                        <div class="stat-value">AWS S3</div>
                    </div>
                </div>
            </div>

            <!-- Recent Trades Table -->
            <div class="card full-width">
                <div class="card-header">
                    <span class="card-title">Recent Trades (DivergeBot)</span>
                    <span class="badge badge-info">Last 16 trades</span>
                </div>
                <div style="overflow-x: auto;">
                    <table class="trade-table" id="trades-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Direction</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Integration Tests -->
            <div class="card full-width">
                <div class="card-header">
                    <span class="card-title">Integration & Backtest Tests</span>
                    <span class="badge badge-success">AWS Connected</span>
                </div>
                <ul class="test-list">
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> S3 Data Fetcher</span>
                        <span class="test-status passed">Connected - eu-west-1</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> FlatBuffer Price Reader</span>
                        <span class="test-status passed">2.6M ticks loaded</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> DivergeBot Backtest</span>
                        <span class="test-status passed">500K ticks processed</span>
                    </li>
                    <li class="test-item">
                        <span class="test-name"><span class="test-icon">âœ…</span> OHLC Candle Generator</span>
                        <span class="test-status passed">47 hourly candles</span>
                    </li>
                </ul>
            </div>
        </div>

        <p class="timestamp" id="timestamp">Last updated: Loading...</p>
    </div>

    <script>
        // Real backtest data from DivergeBot run on Nov 2-4, 2017
        const backtestData = {
            meta: {
                start_timestamp: 1509580800,
                end_timestamp: 1512172800,
                total_ticks: 2624154,
                processed_ticks: 500000,
                ema_period: 100,
                divergence_threshold: 0.003,
                trade_size: 1.0,
                candle_interval: 3600
            },
            summary: {
                total_trades: 16,
                total_profit: 370.40,
                avg_profit_per_trade: 23.15
            },
            candles: [
                { time: 1509627600, open: 6975.0, high: 7189.0, low: 6953.1, close: 7144.8 },
                { time: 1509631200, open: 7144.7, high: 7171.5, low: 7000.0, close: 7057.9 },
                { time: 1509634800, open: 7057.9, high: 7132.6, low: 7030.0, close: 7096.9 },
                { time: 1509638400, open: 7096.9, high: 7099.0, low: 6930.0, close: 6955.5 },
                { time: 1509642000, open: 6955.6, high: 7025.3, low: 6878.5, close: 6985.7 },
                { time: 1509645600, open: 6985.2, high: 6990.1, low: 6836.1, close: 6883.6 },
                { time: 1509649200, open: 6883.7, high: 7010.0, low: 6871.1, close: 6985.4 },
                { time: 1509652800, open: 6985.3, high: 7135.1, low: 6935.9, close: 7062.5 },
                { time: 1509656400, open: 7062.5, high: 7100.0, low: 7042.5, close: 7087.6 },
                { time: 1509660000, open: 7087.7, high: 7100.0, low: 7053.3, close: 7085.1 },
                { time: 1509663600, open: 7002.4, high: 7089.5, low: 6990.5, close: 7025.8 },
                { time: 1509667200, open: 7025.8, high: 7059.7, low: 6951.2, close: 6951.9 },
                { time: 1509670800, open: 6952.0, high: 7000.0, low: 6920.0, close: 6995.7 },
                { time: 1509674400, open: 6995.6, high: 7047.9, low: 6994.0, close: 7038.0 },
                { time: 1509678000, open: 7038.0, high: 7280.6, low: 7038.0, close: 7211.0 },
                { time: 1509681600, open: 7211.0, high: 7300.0, low: 7173.0, close: 7213.2 },
                { time: 1509685200, open: 7213.1, high: 7266.4, low: 7135.3, close: 7239.9 },
                { time: 1509688800, open: 7239.9, high: 7285.3, low: 7201.0, close: 7209.6 },
                { time: 1509692400, open: 7207.6, high: 7350.0, low: 7205.0, close: 7303.2 },
                { time: 1509696000, open: 7330.7, high: 7450.4, low: 7281.0, close: 7431.6 },
                { time: 1509699600, open: 7370.8, high: 7429.1, low: 7370.0, close: 7393.3 },
                { time: 1509710400, open: 7327.4, high: 7329.0, low: 7294.1, close: 7310.7 },
                { time: 1509714000, open: 7310.8, high: 7325.1, low: 7178.8, close: 7216.8 },
                { time: 1509717600, open: 7216.8, high: 7313.0, low: 7166.0, close: 7273.7 },
                { time: 1509721200, open: 7273.8, high: 7360.6, low: 7260.1, close: 7331.4 },
                { time: 1509724800, open: 7331.3, high: 7337.8, low: 7260.2, close: 7281.4 },
                { time: 1509728400, open: 7281.5, high: 7287.3, low: 7238.9, close: 7272.0 },
                { time: 1509732000, open: 7272.0, high: 7341.7, low: 7271.9, close: 7334.2 },
                { time: 1509735600, open: 7334.2, high: 7343.0, low: 7242.9, close: 7292.1 },
                { time: 1509739200, open: 7292.2, high: 7304.9, low: 7217.5, close: 7217.6 },
                { time: 1509742800, open: 7217.6, high: 7227.0, low: 7100.0, close: 7147.8 },
                { time: 1509746400, open: 7147.7, high: 7241.0, low: 7140.0, close: 7160.0 },
                { time: 1509750000, open: 7160.1, high: 7209.2, low: 7139.9, close: 7146.5 },
                { time: 1509753600, open: 7146.6, high: 7154.5, low: 7021.1, close: 7077.0 },
                { time: 1509757200, open: 7077.0, high: 7122.5, low: 6983.6, close: 7119.5 },
                { time: 1509760800, open: 7120.0, high: 7198.0, low: 7118.0, close: 7135.0 },
                { time: 1509764400, open: 7135.1, high: 7229.9, low: 7125.1, close: 7191.1 },
                { time: 1509768000, open: 7191.1, high: 7289.9, low: 7182.1, close: 7257.4 },
                { time: 1509771600, open: 7257.5, high: 7257.5, low: 7166.6, close: 7174.6 },
                { time: 1509775200, open: 7173.3, high: 7190.5, low: 7127.0, close: 7137.0 },
                { time: 1509778800, open: 7137.0, high: 7272.0, low: 7131.8, close: 7235.7 },
                { time: 1509782400, open: 7235.6, high: 7250.0, low: 7159.0, close: 7172.3 },
                { time: 1509786000, open: 7172.4, high: 7213.3, low: 7150.0, close: 7159.8 },
                { time: 1509789600, open: 7159.8, high: 7185.0, low: 7102.4, close: 7148.0 },
                { time: 1509793200, open: 7148.0, high: 7190.0, low: 7114.6, close: 7141.2 },
                { time: 1509796800, open: 7141.2, high: 7215.0, low: 7132.8, close: 7205.8 },
                { time: 1509800400, open: 7205.8, high: 7267.0, low: 7185.0, close: 7262.5 }
            ],
            pnl: [
                { timestamp: 1509628666, pnl: 26.20 },
                { timestamp: 1509628673, pnl: 44.10 },
                { timestamp: 1509628689, pnl: 83.20 },
                { timestamp: 1509628691, pnl: 119.10 },
                { timestamp: 1509628691, pnl: 155.60 },
                { timestamp: 1509628693, pnl: 185.60 },
                { timestamp: 1509628693, pnl: 226.00 },
                { timestamp: 1509628693, pnl: 255.60 },
                { timestamp: 1509628694, pnl: 295.10 },
                { timestamp: 1509628695, pnl: 334.70 },
                { timestamp: 1509663649, pnl: 328.40 },
                { timestamp: 1509683559, pnl: 351.20 },
                { timestamp: 1509696020, pnl: 344.30 },
                { timestamp: 1509700785, pnl: 355.30 },
                { timestamp: 1509713541, pnl: 354.90 },
                { timestamp: 1509797070, pnl: 370.40 }
            ],
            trades: [
                { entry_time: 1509628665, exit_time: 1509628666, entry_price: 7083.9, exit_price: 7110.1, direction: "long", profit: 26.20 },
                { entry_time: 1509628668, exit_time: 1509628673, entry_price: 7082.1, exit_price: 7100.0, direction: "long", profit: 17.90 },
                { entry_time: 1509628689, exit_time: 1509628689, entry_price: 7101.0, exit_price: 7140.1, direction: "long", profit: 39.10 },
                { entry_time: 1509628691, exit_time: 1509628691, entry_price: 7104.2, exit_price: 7140.1, direction: "long", profit: 35.90 },
                { entry_time: 1509628691, exit_time: 1509628691, entry_price: 7104.2, exit_price: 7140.7, direction: "long", profit: 36.50 },
                { entry_time: 1509628691, exit_time: 1509628693, entry_price: 7110.0, exit_price: 7140.0, direction: "long", profit: 30.00 },
                { entry_time: 1509628693, exit_time: 1509628693, entry_price: 7100.3, exit_price: 7140.7, direction: "long", profit: 40.40 },
                { entry_time: 1509628693, exit_time: 1509628693, entry_price: 7100.4, exit_price: 7130.0, direction: "long", profit: 29.60 },
                { entry_time: 1509628694, exit_time: 1509628694, entry_price: 7100.5, exit_price: 7140.0, direction: "long", profit: 39.50 },
                { entry_time: 1509628695, exit_time: 1509628695, entry_price: 7100.4, exit_price: 7140.0, direction: "long", profit: 39.60 },
                { entry_time: 1509663601, exit_time: 1509663649, entry_price: 7002.4, exit_price: 6996.1, direction: "long", profit: -6.30 },
                { entry_time: 1509683558, exit_time: 1509683559, entry_price: 7234.5, exit_price: 7211.7, direction: "short", profit: 22.80 },
                { entry_time: 1509696002, exit_time: 1509696020, entry_price: 7330.7, exit_price: 7337.6, direction: "short", profit: -6.90 },
                { entry_time: 1509700769, exit_time: 1509700785, entry_price: 7370.8, exit_price: 7381.8, direction: "long", profit: 11.00 },
                { entry_time: 1509713464, exit_time: 1509713541, entry_price: 7327.4, exit_price: 7327.0, direction: "long", profit: -0.40 },
                { entry_time: 1509797034, exit_time: 1509797070, entry_price: 7160.6, exit_price: 7176.1, direction: "long", profit: 15.50 }
            ]
        };

        // Calculate win rate
        const winningTrades = backtestData.trades.filter(t => t.profit > 0).length;
        const winRate = (winningTrades / backtestData.trades.length * 100).toFixed(1);
        document.getElementById('win-rate').textContent = winRate + '%';

        // Create chart
        const chartContainer = document.getElementById('chart-container');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: {
                background: { type: 'solid', color: 'transparent' },
                textColor: '#8892b0',
            },
            grid: {
                vertLines: { color: 'rgba(255,255,255,0.05)' },
                horzLines: { color: 'rgba(255,255,255,0.05)' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: 'rgba(255,255,255,0.1)',
            },
            timeScale: {
                borderColor: 'rgba(255,255,255,0.1)',
                timeVisible: true,
            },
        });

        // Add candlestick series for BTC price
        const candleSeries = chart.addCandlestickSeries({
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderDownColor: '#ef5350',
            borderUpColor: '#26a69a',
            wickDownColor: '#ef5350',
            wickUpColor: '#26a69a',
        });
        candleSeries.setData(backtestData.candles);

        // Add P&L line series on separate scale
        const pnlSeries = chart.addLineSeries({
            color: '#7b2cbf',
            lineWidth: 2,
            priceScaleId: 'pnl',
            priceFormat: {
                type: 'custom',
                formatter: (price) => '$' + price.toFixed(0),
            },
        });

        // Create P&L data aligned with candles
        const pnlData = [];
        let pnlIndex = 0;
        for (const candle of backtestData.candles) {
            // Find the latest PNL before this candle's end time
            while (pnlIndex < backtestData.pnl.length - 1 &&
                   backtestData.pnl[pnlIndex + 1].timestamp <= candle.time + 3600) {
                pnlIndex++;
            }
            if (backtestData.pnl[pnlIndex].timestamp <= candle.time + 3600) {
                pnlData.push({
                    time: candle.time,
                    value: backtestData.pnl[pnlIndex].pnl
                });
            }
        }

        // Add starting point
        if (pnlData.length > 0 && pnlData[0].value > 0) {
            pnlData.unshift({ time: backtestData.candles[0].time, value: 0 });
        }

        pnlSeries.setData(pnlData);

        // Configure P&L scale on right side
        chart.priceScale('pnl').applyOptions({
            scaleMargins: { top: 0.1, bottom: 0.4 },
        });

        // Add markers for trades
        const markers = [];
        for (const trade of backtestData.trades) {
            // Find closest candle to trade time
            const closestCandle = backtestData.candles.reduce((prev, curr) => {
                return Math.abs(curr.time - trade.entry_time) < Math.abs(prev.time - trade.entry_time) ? curr : prev;
            });

            markers.push({
                time: closestCandle.time,
                position: trade.direction === 'long' ? 'belowBar' : 'aboveBar',
                color: trade.profit > 0 ? '#00c853' : '#ff5252',
                shape: trade.direction === 'long' ? 'arrowUp' : 'arrowDown',
                text: (trade.profit > 0 ? '+' : '') + '$' + trade.profit.toFixed(0),
            });
        }
        candleSeries.setMarkers(markers);

        // Fit content
        chart.timeScale().fitContent();

        // Populate trades table
        const tradesTable = document.getElementById('trades-table').querySelector('tbody');
        backtestData.trades.forEach(trade => {
            const row = document.createElement('tr');
            const time = new Date(trade.entry_time * 1000).toLocaleString('en-US', {
                month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });
            const profitClass = trade.profit > 0 ? 'positive' : 'negative';
            const profitSign = trade.profit > 0 ? '+' : '';

            row.innerHTML = `
                <td>${time}</td>
                <td style="color: ${trade.direction === 'long' ? '#00c853' : '#ff5252'}">${trade.direction.toUpperCase()}</td>
                <td>$${trade.entry_price.toFixed(1)}</td>
                <td>$${trade.exit_price.toFixed(1)}</td>
                <td class="${profitClass}">${profitSign}$${trade.profit.toFixed(2)}</td>
            `;
            tradesTable.appendChild(row);
        });

        // Update timestamp
        document.getElementById('timestamp').textContent =
            'Last updated: ' + new Date().toLocaleString() + ' | Data: Real S3 backtest from BitMEX BTC/USD';

        // Add subtle animation to cards on load
        document.querySelectorAll('.card').forEach((card, i) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s, transform 0.5s';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, i * 100);
        });

        // Handle resize
        window.addEventListener('resize', () => {
            chart.applyOptions({ width: chartContainer.clientWidth });
        });
    </script>
</body>
</html>
